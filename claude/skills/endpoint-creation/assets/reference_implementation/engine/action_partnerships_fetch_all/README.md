# Engine FetchAll Example: Action Partnerships

**Pattern**: Empty Request FetchAll (no parameters, returns all records)

## What This Demonstrates

- [CRITICAL] Proto-first design (type + endpoint definitions)
- [CRITICAL] Service V2.0 annotation for code generation
- [CRITICAL] Empty request message (no filtering)
- [CRITICAL] Endpoint implements abstract interface
- [CRITICAL] Controller includes generated mixin
- [PREFERRED] Testing with RPC client

## When to Use This Pattern

Use empty request FetchAll when:
- Dataset is small (< 1000 records)
- Populating dropdown lists
- Loading reference data
- No filtering needed

## Complete Workflow

### 1. Define Proto Type (`protos/types/v2/action_partnership.proto`)
Defines the resource structure.

### 2. Define Proto Endpoint (`protos/v2/action_partnerships_endpoint.proto`)
Defines the service with empty request message.

### 3. Generate Code
```bash
bin/protos
git checkout actions_api/lib/actions_api.rb  # Restore after generation
```

Generates: `generated/` files (interface.rb, client.rb, controller.rb, routes.rb, rpc_client.rb)

### 4. Implement Endpoint (`impl/endpoint.rb`)
Business logic: query database, map to structs.

### 5. Create Controller (`impl/controller.rb`)
Includes generated mixin, provides #endpoint accessor.

### 6. Mount Routes (`config/routes.rb`)
```ruby
ActionsEngine::Engine.routes.draw do
  extend ActionsAPI::V2::ActionPartnershipsEndpoint::Routes
end
```

### 7. Write Tests (`spec/action_partnerships_controller_spec.rb`)
Full-stack test using RPC client.

## Key Files

- **protos/** - Source of truth (proto definitions)
- **generated/** - Auto-generated by bin/protos (DO NOT EDIT)
- **impl/** - Your code (business logic + HTTP wiring)
- **spec/** - Tests (validate full stack)
